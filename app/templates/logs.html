<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日志 - 网络入侵检测与防御系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fa fa-shield"></i> 网络入侵检测与防御系统
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="切换导航">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">主页</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="/dashboard">仪表盘</a>
                    </li> -->
                    <li class="nav-item">
                        <a class="nav-link" href="/logs">日志</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link active" href="/settings">设置</a>
                    </li> -->
                </ul>
            </div>
        </div>
    </nav>

    

        <div class="row">
            <div class="col-md-12">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">系统事件</h5>
                        <button class="btn btn-sm btn-outline-secondary" id="clearEvents">
                            清除所有事件
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="systemEvents" class="system-events">
                            <div class="event-item">
                                <div class="event-time">{{ now }}</div>
                                <div class="event-type info">信息</div>
                                <div class="event-message">系统初始化完成</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

   

    

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.4.0/dist/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script >
        // 日志页面JavaScript文件
        $(document).ready(function() {
            // 连接WebSocket
            const socket = io();
            
            let logs = [];
            let filteredLogs = [];
            let currentPage = 1;
            let logsPerPage = 20;
            let currentFilter = 'all';
            let currentSort = 'newest';
            
            // 初始化
            init();
            
            function init() {
                // 加载日志数据
                loadLogs();
                
                // 设置按钮事件
                setupEventHandlers();
                
                // 设置WebSocket监听
                setupSocketEvents();
                
                // 添加系统事件
                addSystemEvent('信息', '日志页面已加载');
            }
            
            // 加载日志数据
            function loadLogs() {
                $.get('/api/logs', function(data) {
                    logs = data.logs || [];
                    applyFilterAndSort();
                    renderLogs();
                    
                    $('#totalLogs').text(logs.length);
                }).fail(function() {
                    $('#logTable').html('<tr><td colspan="6" class="text-center text-danger">加载日志失败</td></tr>');
                });
            }
            
            // 添加系统事件
            function addSystemEvent(type, message) {
                const time = moment().format('HH:mm:ss');
                const typeClass = type.toLowerCase();
                
                const eventHtml = `<div class="event-item">
                    <div class="event-time">${time}</div>
                    <div class="event-type ${typeClass}">${type}</div>
                    <div class="event-message">${message}</div>
                </div>`;
                
                $('#systemEvents').prepend(eventHtml);
                
                // 限制显示的事件数量
                const maxEvents = 100;
                if ($('#systemEvents .event-item').length > maxEvents) {
                    $('#systemEvents .event-item').slice(maxEvents).remove();
                }
            }
            
            
            
            
            // 设置WebSocket事件
            function setupSocketEvents() {
                socket.on('connect', function() {
                    addSystemEvent('信息', '已连接到服务器');
                });
                
                socket.on('disconnect', function() {
                    addSystemEvent('警告', '与服务器的连接已断开');
                });
            }
        }); 
    </script>
</body>
</html>
